<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kemahiran Pemulihan: Masa dan Kalendar (Pembelajaran)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; }
    .activity-card { min-height: 400px; }
    /* Pastikan .schedule-item juga ada transition */
    .number-card, .activity-item, .date-cell, .schedule-item { transition: all .3s ease; cursor: pointer; }
    .number-card:hover, .activity-item:hover, .date-cell:hover:not(.date-empty) { transform: scale(1.05); }
    /* Hover untuk baris jadual di Aktiviti 2 */
    .schedule-item-clickable:hover { 
      transform: translateX(5px);
      background-color: #f9fafb; /* bg-gray-50 */
    }
    .dragging { opacity: .5; transform: rotate(5deg); }

    /* Drop zone */
    .drop-zone {
      border: 2px dashed #cbd5e1;
      transition: all .3s ease;
      min-width: 60px;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .drop-zone.drag-over { border-color: #3b82f6; background-color: #eff6ff; }

    /* Salah */
    @keyframes shake {
      0% { transform: translateX(0); } 25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); } 75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 0.5s ease; }

    /* Zon sudah diisi */
    .drop-zone-filled {
      border-style: solid;
      border-color: #4ade80;
      background-color: #f0fdf4;
    }
    
    /* Gaya untuk aktiviti kalendar & jam */
    /* Highlight kuning untuk Aktiviti 1 (Baharu) */
    .schedule-item-display.highlight { 
        background-color: #fef9c3; /* bg-yellow-100 */
        border-color: #facc15; /* border-yellow-400 */
        transform: scale(1.02);
    } 
    .date-cell:not(.date-empty):hover { background-color: #f0f9ff; }
    .date-cell.special { background-color: #fefce8; font-bold: true; }
    .date-cell.today { background-color: #bfdbfe; border: 2px solid #3b82f6; }
    .date-cell.semalam { background-color: #f1f5f9; border: 2px solid #94a3b8; }
    .date-cell.esok { background-color: #ecfdf5; border: 2px solid #22c55e; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-full">

  <div class="bg-yellow-100 border-b-4 border-yellow-300 p-4 shadow-sm sticky top-0 z-10">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üìö</span>
        <span id="info-text" class="text-lg font-semibold text-gray-800">
          Pilih aktiviti untuk mula belajar masa dan kalendar!
        </span>
      </div>
      <button id="speak-btn"
              class="bg-yellow-300 hover:bg-yellow-400 text-yellow-800 font-bold py-2 px-4 rounded-full text-xl transition-colors duration-200"
              onclick="speakInfo()">
        üîä
      </button>
    </div>
  </div>

  <div class="max-w-6xl mx-auto p-6">
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 activity-card flex items-center justify-center">
      <div id="activity-content" class="text-center w-full"> 
        <div class="py-16">
          <div class="text-6xl mb-4">üóìÔ∏è‚è∞</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">
            Kemahiran Pemulihan: Masa dan Kalendar
          </h2>
          <p class="text-xl text-gray-600 mb-8">
            Pilih aktiviti di bawah untuk meneroka jadual harian dan kalendar.
          </p>
          <div class="text-4xl">üëá</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">Pilih Aktiviti</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
        <button onclick="loadActivity(1)"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          ü§î Pukul Berapa?
        </button>
        <button onclick="loadActivity(2)"
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          üìã Cari Aktiviti
        </button>
        <button onclick="loadActivity(3)"
                class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          üïí Padanan Jam
        </button>
        <button onclick="loadActivity(4)"
                class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          üóìÔ∏è Detektif Kalendar
        </button>
        <button onclick="loadActivity(5)"
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          ‚è™ Mesin Masa ‚è©
        </button>
      </div>

      <div class="flex justify-center gap-4">
        <button onclick="clearActivity()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          üßπ Bersih
        </button>
        <button onclick="nextActivity()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          ‚û°Ô∏è Seterusnya
        </button>
      </div>
    </div>
  </div>

  <script>
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Pilih aktiviti untuk mula belajar masa dan kalendar!";
    let draggedElement = null; // Masih digunakan oleh Aktiviti 3

    // State untuk aktiviti
    window.mesinMasaState = { today: 15, current: 15 };
    
    // === DATA JADUAL INDUK (Digunakan oleh Aktiviti 1 & 2) ===
    const masterSchedule = [
      { time: "8:00 - 8:30 PG", activity: "Perhimpunan" },
      { time: "8:30 - 9:30 PG", activity: "Matematik" },
      { time: "9:30 - 10:00 PG", activity: "Rehat" },
      { time: "10:00 - 11:00 PG", activity: "Sains" },
      { time: "11:00 - 11:30 PG", activity: "Bahasa Melayu" },
      { time: "11:30 - 12:00 PTG", activity: "Pendidikan Seni" },
      { time: "12:00 - 12:30 PTG", activity: "Pendidikan Jasmani" },
      { time: "12:30 - 1:00 PTG", activity: "Kemas Kelas & Pulang" }
    ];
    let currentScheduleIndex = 0;
    // === AKHIR DATA ===

    /* ====== TTS ====== */
    function speak(text) {
      if (!ttsEnabled) return;
      if (!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      setTimeout(() => {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ms-MY';
        u.rate = 0.9; u.pitch = 1.05;
        const voices = window.speechSynthesis.getVoices();
        const ms = voices.find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms'));
        if (ms) u.voice = ms;
        window.speechSynthesis.speak(u);
      }, 100);
    }
    function setInfo(text) { currentInfo = text; document.getElementById('info-text').textContent = text; }
    function speakInfo() {
      if (!ttsEnabled) {
        ttsEnabled = true;
        const btn = document.getElementById('speak-btn');
        btn.classList.add('bg-green-300', 'hover:bg-green-400');
        btn.classList.remove('bg-yellow-300', 'hover:bg-yellow-400');
      }
      speak(currentInfo);
    }

    /* ====== DnD helpers (Untuk Aktiviti 3) ====== */
    function dragStart(e) { draggedElement = e.target; e.target.classList.add('dragging'); }
    function dragEnd(e) { e.target.classList.remove('dragging'); document.querySelectorAll('.drop-zone').forEach(z=>z.classList.remove('drag-over')); }
    function allowDrop(e) { e.preventDefault(); if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.add('drag-over'); }
    function dragLeave(e) { if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.remove('drag-over'); }

    /* ====== Router (Aktiviti 1 dikemas kini) ====== */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      if (n === 1) return loadWhatActivity(content); // <-- FUNGSI BAHARU
      if (n === 2) return loadCariAktiviti(content);
      if (n === 3) return loadPadananJam(content);
      if (n === 4) return loadDetektifKalendar(content);
      if (n === 5) return loadMesinMasa(content);
    }

    /* ====== FUNGSI AKTIVITI 1 DIKEMAS KINI ====== */
    function loadWhatActivity(content) {
      setInfo("Klik kad masa di bawah. Lihat apa aktiviti kamu pada masa itu!");

      // Kad masa dan aktiviti sepadan
      const timeCards = [
        { time: "8:15 PG", activity: "Perhimpunan" },
        { time: "9:00 PG", activity: "Matematik" },
        { time: "9:45 PG", activity: "Rehat" },
        { time: "10:30 PG", activity: "Sains" },
        { time: "11:45 PG", activity: "Pendidikan Seni" },
        { time: "12:45 PTG", activity: "Kemas Kelas & Pulang" }
      ];
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-blue-600 mb-6">ü§î Aktiviti Saya Pukul Berapa?</h3>
        
        <div class="w-full md:w-3/4 mx-auto max-h-[300px] overflow-y-auto p-2 mb-6">
          <h4 class="text-lg font-semibold mb-2 text-left">Jadual Harian:</h4>
          <div id="schedule-list-display" class="space-y-2">
            ${masterSchedule.map(item => `
              <div class="schedule-item-display border-2 p-3 rounded-lg text-left text-lg"
                   data-activity-display="${item.activity}">
                <strong>${item.time}:</strong> ${item.activity}
              </div>
            `).join('')}
          </div>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-3">Klik Kad Masa:</h4>
          <div class="flex flex-wrap justify-center gap-4">
            ${timeCards.sort(() => Math.random() - 0.5).map(card => `
              <button class="number-card bg-blue-100 hover:bg-blue-200 border-2 border-blue-300 rounded-xl p-4 text-center"
                      onclick="checkWhatActivity('${card.time}', '${card.activity}')">
                <div class="text-2xl font-bold text-blue-800">${card.time}</div>
              </button>
            `).join('')}
          </div>
        </div>
      `;
    }

    function checkWhatActivity(timeStr, correctActivity) {
      // 1. Bersihkan semua highlight
      document.querySelectorAll('.schedule-item-display').forEach(el => {
        el.classList.remove('highlight', 'border-yellow-400', 'bg-yellow-100', 'scale-102');
      });

      // 2. Cari baris yang sepadan
      const scheduleList = document.getElementById('schedule-list-display');
      const targetRow = scheduleList.querySelector(`[data-activity-display="${correctActivity}"]`);

      // 3. Highlight baris itu
      if (targetRow) {
        targetRow.classList.add('highlight', 'border-yellow-400', 'bg-yellow-100', 'scale-102');
        // Skrol ke baris itu jika ia di luar pandangan
        targetRow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }

      // 4. Kemas kini info
      const msg = `Pada pukul ${timeStr}, kamu sedang... ${correctActivity}!`;
      setInfo(msg);
      speak(msg);
    }
    /* ====== AKHIR FUNGSI AKTIVITI 1 ====== */


    /* ====== FUNGSI AKTIVITI 2 (Kekal) ====== */
    function loadCariAktiviti(content) {
      currentScheduleIndex = Math.floor(Math.random() * masterSchedule.length);
      const question = masterSchedule[currentScheduleIndex];
      
      setInfo(`Cari aktiviti ini: ${question.activity}. Sila klik pada baris yang betul.`);
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-green-600 mb-6">üìã Jom Cari Aktiviti!</h3>
        
        <div class="bg-green-50 p-4 rounded-lg text-center mb-6">
          <p class="text-lg text-gray-700">Arahan:</p>
          <p id="jadual-prompt" class="text-3xl font-bold text-green-800">
            Sila klik pada baris untuk: <strong>${question.activity}</strong>
          </p>
        </div>

        <div class="w-full md:w-3/4 mx-auto max-h-[400px] overflow-y-auto p-2">
          <h4 class="text-lg font-semibold mb-2 text-left">Jadual Harian:</h4>
          <div id="jadual-list" class="space-y-2">
            ${masterSchedule.map(item => `
              <div class="schedule-item schedule-item-clickable border-2 p-4 rounded-lg text-left text-xl"
                   data-activity="${item.activity}"
                   onclick="checkJadualClick(event, '${question.activity}', '${item.time}')">
                <strong>${item.time}:</strong> ${item.activity}
              </div>
            `).join('')}
          </div>
        </div>
        
        <div id="jadual-feedback" class="mt-4 text-xl font-semibold min-h-8 text-center"></div>
      `;
      
      speak(currentInfo); // Sebut arahan
    }

    function checkJadualClick(e, correctActivity, correctTime) {
      const clickedRow = e.currentTarget;
      const clickedActivity = clickedRow.dataset.activity;
      const feedback = document.getElementById('jadual-feedback');
      
      document.querySelectorAll('.schedule-item').forEach(el => el.classList.remove('shake'));
      
      if (clickedActivity === correctActivity) {
        feedback.textContent = `Betul! ${correctActivity} pada ${correctTime}.`;
        feedback.className = "mt-4 text-xl font-semibold text-center text-green-600";
        setInfo(feedback.textContent); speak(feedback.textContent);
        
        clickedRow.classList.add('border-green-400', 'bg-green-100');
        
        document.querySelectorAll('#jadual-list .schedule-item').forEach(el => {
          el.onclick = null;
          el.classList.remove('cursor-pointer', 'schedule-item-clickable');
          if (el !== clickedRow) el.classList.add('opacity-50');
        });

      } else {
        feedback.textContent = `Itu ${clickedActivity}. Cuba cari ${correctActivity}.`;
        feedback.className = "mt-4 text-xl font-semibold text-center text-red-600";
        setInfo(feedback.textContent); speak(feedback.textContent);
        
        clickedRow.classList.add('shake');
        setTimeout(() => clickedRow.classList.remove('shake'), 500);
      }
    }
    /* ====== AKHIR FUNGSI AKTIVITI 2 ====== */


    /* ====== Aktiviti 3: Padanan Jam (Kekal) ====== */
    function loadPadananJam(content) {
      setInfo("Padankan jam analog dengan masa digital. Seret jam ke kotak yang betul.");
      
      const times = [
        { emoji: "üïò", correct: "9:00" },
        { emoji: "üïí", correct: "3:00" },
        { emoji: "üïï", correct: "6:00" }
      ];
      const shuffledTimes = [...times].sort(() => Math.random() - 0.5);
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-purple-600 mb-6">üïí Padanan Jam</h3>
        <div class="flex flex-col md:flex-row gap-6 justify-around">
          
          <div class="w-full md:w-1/3">
            <h4 class="text-lg font-semibold mb-2">Pilih Jam:</h4>
            <div id="jam-choices" class="flex flex-col gap-4">
              ${shuffledTimes.map(time => `
                <div class="activity-item text-7xl bg-purple-100 border-2 border-purple-300 rounded-lg p-4 text-center cursor-move"
                     draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-correct="${time.correct}">
                  ${time.emoji}
                </div>
              `).join('')}
            </div>
          </div>

          <div class="w-full md:w-1/2">
            <h4 class="text-lg font-semibold mb-2">Slot Masa:</h4>
            <div class="space-y-3">
              ${times.map(time => `
                <div class="flex items-center gap-2">
                  <span class="font-bold text-2xl w-24">${time.correct}</span>
                  <div class="drop-zone w-full p-8 rounded-lg" 
                       ondrop="dropOnJam(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" 
                       data-correct="${time.correct}">...</div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function dropOnJam(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('drag-over');
      if (!draggedElement) return;
      
      const draggedCorrect = draggedElement.dataset.correct;
      const dropCorrect = e.currentTarget.dataset.correct;
      
      if (draggedCorrect === dropCorrect) {
        e.currentTarget.innerHTML = draggedElement.innerHTML; // Pindahkan emoji
        e.currentTarget.classList.add('drop-zone-filled', 'text-7xl');
        e.currentTarget.classList.remove('drop-zone');
        e.currentTarget.removeAttribute('ondrop');
        draggedElement.remove(); draggedElement = null;
        
        const msg = `Betul! Jam ${draggedCorrect} dipadankan.`;
        setInfo(msg); speak(msg);
        
        if (document.querySelectorAll('#activity-content .drop-zone').length === 0) {
          setInfo("Syabas! Semua jam dipadankan!"); speak("Syabas! Semua jam dipadankan!");
        }
      } else {
        setInfo(`Bukan jam itu. Cuba lagi.`); speak(`Bukan jam itu. Cuba lagi.`);
        e.currentTarget.classList.add('shake');
        setTimeout(() => e.currentTarget.classList.remove('shake'), 500);
      }
    }


    /* ====== Aktiviti 4: Detektif Kalendar (Kekal) ====== */
    function loadDetektifKalendar(content) {
      setInfo("Jom jadi detektif! Klik mana-mana tarikh dalam kalendar Ogos.");
      const days = ["A", "I", "S", "R", "K", "J", "S"];
      const dates = [
        ...Array(4).fill(null), // Kosong sebelum 1hb
        ...Array(31).fill(0).map((_, i) => i + 1), // 1-31
        ...Array(7).fill(null) // Kosong selepas 31hb
      ].slice(0, 35);
      
      const events = {
        1: "Hari Pertama Ogos",
        15: "Hari Jadi Ali",
        31: "Hari Merdeka!"
      };
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-orange-600 mb-4">üóìÔ∏è Detektif Kalendar</h3>
        <p class="text-xl text-gray-700 mb-4">Bulan Ogos</p>
        
        <div class="grid grid-cols-7 gap-1 bg-white p-2 rounded-lg shadow">
          ${days.map(d => `<div class="font-bold text-center p-2 text-gray-500">${d}</div>`).join('')}
          ${dates.map(date => {
            if (!date) return `<div class="date-cell date-empty p-2 h-16"></div>`;
            const event = events[date];
            return `
              <div class="date-cell border rounded-lg p-2 h-16 ${event ? 'special bg-yellow-50' : ''}"
                   onclick="clickKalendar(${date}, '${event || ''}')">
                <span class="font-bold">${date}</span>
                ${event ? `<div class="text-xs text-orange-700">${event.split(' ')[0]}...</div>` : ''}
              </div>
            `;
          }).join('')}
        </div>
        
        <div id="kalendar-info" class="mt-4 p-4 bg-orange-50 rounded-lg text-center text-lg font-semibold text-orange-800 min-h-16">
          Klik pada tarikh untuk lihat maklumat.
        </div>
      `;
    }
    
    function clickKalendar(date, event) {
      const infoBox = document.getElementById('kalendar-info');
      let msg;
      if (event) {
        msg = `Tarikh ${date} Ogos. Ada peristiwa: ${event}!`;
      } else {
        msg = `Tarikh ${date} Ogos. Tiada peristiwa istimewa.`;
      }
      infoBox.textContent = msg;
      setInfo(msg); speak(msg);
    }

    /* ====== Aktiviti 5: Mesin Masa (Kekal) ====== */
    function loadMesinMasa(content) {
      setInfo("Hari ini 15 November. Klik butang 'Semalam' atau 'Esok'!");
      window.mesinMasaState = { today: 15, current: 15 }; // Reset
      
      const dates = Array(5).fill(0).map((_, i) => 13 + i); // 13, 14, 15, 16, 17
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-red-600 mb-6">‚è™ Mesin Masa ‚è©</h3>
        <p class="text-lg mb-4">Lihat kalendar mini ini. Hari ini ialah 15hb.</p>
        
        <div id="mesin-kalendar" class="flex justify-center gap-2 mb-6">
          ${dates.map(d => `
            <div id="date-${d}" class="date-cell border-2 p-6 rounded-lg text-3xl font-bold ${d === 15 ? 'today' : ''}" data-date="${d}">
              ${d}
            </div>
          `).join('')}
        </div>
        
        <div class="flex justify-center gap-4">
          <button onclick="showDate('semalam')" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg text-lg">Semalam</button>
          <button onclick="showDate('hari-ini')" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg text-lg">Hari Ini</button>
          <button onclick="showDate('esok')" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-lg">Esok</button>
        </div>
      `;
    }
    
    function showDate(type) {
      const { today } = window.mesinMasaState;
      let targetDate;
      let msg;
      let newClass;
      
      if (type === 'semalam') {
        targetDate = today - 1;
        msg = `Semalam ialah 14 November.`;
        newClass = 'semalam';
      } else if (type === 'esok') {
        targetDate = today + 1;
        msg = `Esok ialah 16 November.`;
        newClass = 'esok';
      } else { // 'hari-ini'
        targetDate = today;
        msg = `Hari ini ialah 15 November.`;
        newClass = 'today';
      }
      
      document.querySelectorAll('#mesin-kalendar .date-cell').forEach(el => {
        el.classList.remove('today', 'semalam', 'esok');
      });
      
      const el = document.getElementById(`date-${targetDate}`);
      if (el) {
        el.classList.add(newClass);
      }
      
      setInfo(msg); speak(msg);
    }

    /* ====== Kawalan Umum ====== */
    function clearActivity() {
      currentActivity = 0;
      document.getElementById('activity-content').innerHTML = `
        <div class="text-center py-16">
          <div class="text-6xl mb-4">üóìÔ∏è‚è∞</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Kemahiran Pemulihan: Masa dan Kalendar</h2>
          <p class="text-xl text-gray-600 mb-8">Pilih aktiviti di bawah untuk meneroka jadual harian dan kalendar.</p>
          <div class="text-4xl">üëá</div>
        </div>
      `;
      setInfo("Pilih aktiviti untuk mula belajar masa dan kalendar!");
    }
    
    function nextActivity() {
      if (currentActivity === 0) return loadActivity(1);
      if (currentActivity < 5) return loadActivity(currentActivity + 1);
      return loadActivity(1);
    }

    // Kekalkan TTS resume
    if ('speechSynthesis' in window) {
      setInterval(() => { if (window.speechSynthesis.paused) window.speechSynthesis.resume(); }, 1000);
    }
  </script>
</body>
</html>
